<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Citizen Tracking</title>
    <link rel="icon" type="image/png" href="../static/facebiometry.png" sizes="32x32" />
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="{{url_for('css_static', filename='bootstrap.min.css')}}" media="screen" title="no title" charset="utf-8">
    <link rel="stylesheet" href="{{url_for('css_static', filename='style.css')}}">
    <link rel="stylesheet" href="{{url_for('css_static', filename='dropzone.css')}}">
    <link rel="stylesheet" href="../static/css/font-awesome/font-awesome.min.css" >
    <link rel="stylesheet" href="../static/css/stylesheet.css" type="text/css" charset="utf-8" />
    <link rel="stylesheet" href="../static/css/footer-distributed.css" type="text/css" charset="utf-8" />
    <style>
      #map {
        height: 100%;
      }
   </style>

  </head>
  <body>
    <header>
      <div class="container">
        <h1>Citizen Tracking  <img src="../static/facebiometry.png" alt="logo" height="50" width="50"/></h1>
      </div>
    </header>
    <div class="container">
      <img class="object-fit-cover" src="../static/multiplefacerecognition.jpg"/>
    </div>
    <div class="container">
      <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" data-toggle="tab" href="#addPerson" role="tab">Add Person</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-toggle="tab" href="#check_existance" role="tab">Check existance</a>
        </li>
        <li class="nav-item">
          <a id= "tab_map_link" class="nav-link" data-toggle="tab" href="#trajectory" role="tab">Get trajectory</a>
        </li>
      </ul>

<!-- Tab panes -->
<div class="tab-content">
  <div class="tab-pane fade in active" id="addPerson" role="tabpanel">
    <div>
      <form action="/uploadajax" method="POST" enctype="multipart/form-data" role="form" id="compose-photo" class="dropzone">
        <div id="file-uploader">
          <div class="addfile">
            <span class="add-file dz-message" data-toggle="tooltip" title="Add Photo"><i class="glyphicon glyphicon-plus"></i>
              <div class="fallback">
                <input name="photo" id="chose-photo" multiple="" type="file">
              </div>
            </span>
          </div>
        </div>
      </form>
    </div>
    <br>
    <form>
      <fieldset class="form-group row">
        <legend class="col-form-legend col-sm-2">Personal data</legend>
        <div class="col-sm-10">
          <div class="form-group row">
            <label for="inputName" class="col-sm-2 col-form-label">Name</label>
            <div class="col-sm-6">
              <input type="text" class="form-control" id="inputNameAddPerson" placeholder="Name">
            </div>
          </div>
          <div class="form-group row">
            <label for="inputSurname" class="col-sm-2 col-form-label">Surname</label>
            <div class="col-sm-6">
              <input type="text" class="form-control" id="inputSurnameAddPerson" placeholder="Surname">
            </div>
          </div>
          <div class="form-group row">
            <label for="inputDni" class="col-sm-2 col-form-label">Dni</label>
            <div class="col-sm-6">
              <input type="text" class="form-control" id="inputDniAddPerson" placeholder="Dni">
            </div>
          </div>
        </div>
      </fieldset>
    <fieldset class="form-group row">
      <legend class="col-form-legend col-sm-2">Select state</legend>
      <div class="col-sm-10">
        <div class="form-check">
          <label class="form-check-label">
            <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios1" value="option1" checked>
            Legal problems
          </label>
        </div>
        <div class="form-check">
          <label class="form-check-label">
            <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios2" value="option2">
            Missing
          </label>
        </div>
      </div>
    </fieldset>
    <div class="form-group row">
      <div class="offset-sm-2 col-sm-10">
        <button type="submit" class="btn btn-success start" id="startAddPerson">
            <i class="glyphicon glyphicon-upload"></i>
            <span>Submit</span>
        </button>
        <button type="reset" class="btn btn-warning cancel" id="cancelAddPerson">
            <i class="glyphicon glyphicon glyphicon-ban-circle"></i>
            <span>Cancel</span>
        </button>
      </div>
    </div>
  </form>
  </div>
  <div class="tab-pane fade" id="check_existance" role="tabpanel">
    <div>
      <form action="/uploadajax" method="POST" enctype="multipart/form-data" role="form" id="compose-photo-exist" class="dropzone">
        <div id="file-uploader-exist">
          <div class="addfile">
            <span class="add-file dz-message" data-toggle="tooltip" title="Add Photo"><i class="glyphicon glyphicon-plus"></i>
              <div class="fallback">
                <input name="photo" id="chose-photo" multiple="" type="file">
              </div>
            </span>
          </div>
        </div>
      </form>
    </div>
    <br>
    <form>
      <fieldset class="form-group row">
        <legend class="col-form-legend col-sm-2">Personal data</legend>
        <div class="col-sm-10">
          <div class="form-group row">
            <label for="outputName" class="col-sm-2 col-form-label">Name</label>
            <div class="col-sm-6" id="outputName">
            </div>
          </div>
          <div class="form-group row">
            <label for="outputSurname" class="col-sm-2 col-form-label">Surname</label>
            <div class="col-sm-6" id="outputSurname">
          </div>
        </div>
          <div class="form-group row">
            <label for="outputDni" class="col-sm-2 col-form-label">Dni</label>
            <div class="col-sm-6" id="outputDni">
            </div>
          </div>
          <div class="form-group row">
            <label for="outputState" class="col-sm-2 col-form-label">State</label>
            <div class="col-sm-6" id="outputState">
            </div>
          </div>
        </div>
    </fieldset>
    <div class="form-group row">
      <div class="offset-sm-2 col-sm-10">
        <button type="submit" class="btn btn-success start" id="startExistance">
            <i class="glyphicon glyphicon-upload"></i>
            <span>Submit</span>
        </button>
        <button type="reset" class="btn btn-warning cancel" id="cancelExistance">
            <i class="glyphicon glyphicon glyphicon-ban-circle"></i>
            <span>Cancel</span>
        </button>
      </div>
    </div>
  </form>
  </div>
  <div class="tab-pane fade" id="trajectory" role="tabpanel">
    <form>
      <fieldset class="form-group row">
        <div class="col-sm-5">
           <form action="" class="search-form">
           <div class="form-group has-feedback">
              <label for="inputDni" class="col-sm-6 col-form-label">Search trajectory by Dni</label>
              <span class="glyphicon glyphicon-search form-control-feedback"></span>
              <input type="text" class="form-control" id="inputDniTrajectory" placeholder="Dni">
          </div>
        </form>
        </div>
      </fieldset>
    <div id="preview_photos" class="row" style="display:none">
      <div id="myCarousel" class="col-sm-6 carousel slide" style="height: 270px; width: 400px;border:1px solid #000; margin-left: 150px;margin-right:50px;">
        <!-- Indicators -->
        <ol class="carousel-indicators"></ol>
        <div class="carousel-inner"></div>
        <!-- Carousel controls -->
        <a class="left carousel-control" href="#myCarousel" data-slide="prev"><span class="glyphicon glyphicon-chevron-left"></span></a>
        <a class="right carousel-control" href="#myCarousel" data-slide="next"><span class="glyphicon glyphicon-chevron-right"></span></a>
      </div>
    </div>
    <br>
    <div id="trajectory_map" class="row">
      <div id="map" class="col-xs-12" style="height: 800px; width: 800px;border:1px solid #000;"></div>
    </div>
  </form>
  </div>
</div>
  <div class="container">

      <script type="text/javascript" src="{{url_for('js_static', filename='jquery-3.2.1.min.js')}}"></script>
      <script type="text/javascript" src="{{url_for('js_static', filename='dropzone.js')}}"></script>
      <script type="text/javascript" src="{{url_for('js_static', filename='bootstrap.min.js')}}"></script>
      <script type="text/javascript" src="{{url_for('js_static', filename='Displayers/AlreadyExistsDisplayer.js')}}"></script>
      <script type="text/javascript" src="{{url_for('js_static', filename='Displayers/CorrectlyUploadedDisplayer.js')}}"></script>
      <script type="text/javascript" src="{{url_for('js_static', filename='Displayers/UncorrectlyUploadedDisplayer.js')}}"></script>
      <script type="text/javascript" src="{{url_for('js_static', filename='Displayers/DoesntExistDisplayer.js')}}"></script>
      <script type="text/javascript" src="{{url_for('js_static', filename='Displayers/TrajectoryDisplayer.js')}}"></script>
      <script type="text/javascript" src="{{url_for('js_static', filename='Displayers/UnknownTrajectoryDisplayer.js')}}"></script>
      <script type="text/javascript" src="{{url_for('js_static', filename='ResponseDisplayerFactory/ResponseDisplayerFactory.js')}}"></script>
      <script type="text/javascript" src="{{url_for('js_static', filename='dropzoneAddPerson.js')}}"></script>
      <script type="text/javascript" src="{{url_for('js_static', filename='dropzoneExistance.js')}}"></script>
      <script type="text/javascript">
        var directionsDisplay;
        var directionsService;
        var mymap;
        function initMap() {
          console.log("initMap");
          directionsService = new google.maps.DirectionsService();
          directionsDisplay = new google.maps.DirectionsRenderer();
          mymap = new google.maps.Map(document.getElementById('map'), {
          center: new google.maps.LatLng(-34.618696, -58.435593),
          zoom: 13
          });
        }
        $('#tab_map_link').on('shown.bs.tab', function(e) {
        		if( mymap == undefined) {
        			initMap();
        		}
            var center = mymap.getCenter();
            var zoom = mymap.getZoom();
            google.maps.event.trigger(mymap, 'resize');
            mymap.setCenter(center);
            mymap.setZoom(zoom);
        });
        function updateMarker(marker, points, idx) {
            console.log("update marker lat: "+points[idx].lat+" lng: "+points[idx].lng);
            marker.setPosition(new google.maps.LatLng(points[idx].lat, points[idx].lng));
            mymap.panTo(marker.getPosition());
        }
        function calculateRoute(routeExtremes, waypts) {
          var bounds = new google.maps.LatLngBounds();
          for (var i=0; i< routeExtremes.length; i++){
            bounds.extend(routeExtremes[i]);
          }
          mymap.fitBounds(bounds);
          var request = {
              origin: routeExtremes[0],
              destination: routeExtremes[routeExtremes.length - 1],
              waypoints: waypts,
              travelMode: google.maps.TravelMode.WALKING
          };
          directionsService.route(request, function (response, status) {
              if (status == google.maps.DirectionsStatus.OK) {
                  directionsDisplay.setDirections(response);
                  directionsDisplay.setOptions( { suppressMarkers: true } );
                  directionsDisplay.setMap(mymap);
              } else {
                  alert("Directions Request from " + start.toUrlValue(6) + " to " + end.toUrlValue(6) + " failed: " + status);
              }
          });
        }
        function loadImageToCarouselAndDrawRoute(points){
          console.log("loadImageToCarousel");
          routeExtremes=[];
          waypts=[];
          for (var i = 0; i < points.length; i++){
            var filepath="/static/images/"+points[i].image;
            $('<div class="item"><img src="'+filepath+'"><div class="carousel-caption"></div>   </div>').appendTo('.carousel-inner');
            $('<li data-target="#carousel-example-generic" data-slide-to="'+i+'"></li>').appendTo('.carousel-indicators')
            if ((i > 0) && (i< points.length - 1)){
              waypts.push({location: new google.maps.LatLng(points[i].lat, points[i].lng), stopover: true})
            }else{
              routeExtremes.push(new google.maps.LatLng(points[i].lat, points[i].lng))
            }
          }
          calculateRoute(routeExtremes, waypts);
          $('.item').first().addClass('active');
          $('.carousel-indicators > li').first().addClass('active');
          $('.carousel').carousel('pause')
        }
        function AgregarPuntos(locations){
          var points = JSON.parse(locations);
          var marker = new google.maps.Marker({
          animation: google.maps.Animation.BOUNCE,
          map: mymap});
          loadImageToCarouselAndDrawRoute(points);
          updateMarker(marker, points, 0);
          $('#myCarousel').bind('slide.bs.carousel', function (e) {
            console.log("Bind carousel");
            console.log("points: "+ points);
            var slideIdx = $(e.relatedTarget).index();
            updateMarker(marker, points, slideIdx);
          });
        }
      </script>
      <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAZzeHhs-8JZ7i18MjFuM35dJHq70n3Hx4&callback=initMap"></script>
    </div>
  </body>
</html
